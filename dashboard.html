<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="admin_dashboard.css">
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2>Admin Panel</h2>
        <button id="toggle-btn" class="toggle-btn">‚ò∞</button>
      </div>
      <ul class="sidebar-menu">
        <li><a href="#" id="manage-products">üõçÔ∏è Manage Products</a></li>
        <li><a href="#" id="orders">üì¶ Orders</a></li>
        <li><a href="#" id="reviews">‚≠ê Reviews</a></li>
        <li><a href="#" id="settings">‚öôÔ∏è Settings</a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="main-content">
      <h1>Welcome, Admin!</h1>
      <p>Select any section from the sidebar to manage your e-commerce system.</p>
    </div>
  </div>

  


  <script>
    document.addEventListener("DOMContentLoaded", () => {
  const token = localStorage.getItem("access_token");
  console.log("Token found:", token);

  if (!token) {
    alert("You are not logged in! Redirecting to login page...");
    window.location.href = "index.html";
    return;
  }

  // store globally so other functions can access it
  window.authToken = token;
});

  document.addEventListener("DOMContentLoaded", () => {
    const sidebar = document.getElementById("sidebar");
    const toggleBtn = document.getElementById("toggle-btn");
    const mainContent = document.getElementById("main-content");

    if (toggleBtn && sidebar) {
      toggleBtn.addEventListener("click", () => {
        sidebar.classList.toggle("collapsed");
      });
    }

    document.querySelectorAll(".sidebar-menu a").forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const section = e.target.id;

        switch (section) {
          case "manage-products":
            mainContent.innerHTML = `
  <h1>üõçÔ∏è Manage Products</h1>

  <!-- Two-column admin layout: left = add product, right = list/manage -->
  <div class="admin-container">
    <!-- LEFT: Add Product (keeps your exact IDs and form fields) -->
    <div class="admin-left">
      <h3>Add / Create Product</h3>

      <button id="add-product" class="primary-button">Add Product</button>

      <!-- Add Product Modal (kept exactly as before) -->
      <div id="product-modal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" id="closeModalBtn">&times;</span>
          <h2>Add New Product</h2>
          <form id="product-form">
            <div class="form-group">
              <label for="product-name">Name</label>
              <input type="text" id="product-name" name="name" required>
            </div>
            <div class="form-group">
              <label for="product-description">Description</label>
              <textarea id="product-description" name="description" required></textarea>
            </div>
            <div class="form-group">
              <label for="product-price">Price</label>
              <input type="number" id="product-price" name="price" step="0.01" required>
            </div>
            <div class="form-group">
              <label for="product-quantity">Quantity</label>
              <input type="number" id="product-quantity" name="quantity" required>
            </div>
            <div class="form-group">
              <label for="product-size">Size</label>
              <input type="text" id="product-size" name="size">
            </div>
            <div class="form-group">
              <label for="product-color">Color</label>
              <input type="text" id="product-color" name="color">
            </div>
            <div class="form-group">
              <label for="product-category">Category</label>
              <select id="product-category" name="category_id" required></select>
            </div>
            <div class="form-group">
              <label for="product-stock-status">Stock Status</label>
              <select id="product-stock-status" name="stock_status" required>
                <option value="true">In Stock</option>
                <option value="false">Out of Stock</option>
              </select>
            </div>

            <div class="form-buttons">
              <button type="submit" class="submit-button">Save Product</button>
              <button type="button" class="cancel-button" id="cancelModalBtn">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- RIGHT: Existing products + manage table -->
    <div class="admin-right">
      <h3>Existing Products</h3>
      <div id="adminProductList" class="admin-product-list"></div>

      <h3>Manage Products</h3>
      <div id="manage-products-section">
        <table id="admin-products-table" border="1" style="width:100%; border-collapse: collapse;">
          <!-- Products will load here dynamically -->
        </table>
      </div>
    </div>
  </div>
`;


            setupAddProduct();
            loadAdminProducts();
            break;

          case "orders":
            mainContent.innerHTML = `<h1>üì¶ Orders</h1><p>View and process customer orders.</p>`;
            break;

          case "reviews":
            mainContent.innerHTML = `<h1>‚≠ê Reviews</h1><p>Check customer feedback and ratings on products.</p>`;
            break;

          case "settings":
            mainContent.innerHTML = `<h1>‚öôÔ∏è Settings</h1><p>Customize admin preferences and system configurations.</p>`;
            break;
        }
      });
    });
  });

  function setupAddProduct() {
    const modal = document.getElementById("product-modal");
    const openBtn = document.getElementById("add-product");
    const closeBtn = document.getElementById("closeModalBtn");
    const cancelBtn = document.getElementById("cancelModalBtn");
    const form = document.getElementById("product-form");

    openBtn.addEventListener("click", () => {
      modal.style.display = "block";
      loadCategories();
    });

    closeBtn.addEventListener("click", () => modal.style.display = "none");
    cancelBtn.addEventListener("click", () => modal.style.display = "none");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const token = localStorage.getItem("access_token");
      const formData = {
        name: document.getElementById("product-name").value,
        description: document.getElementById("product-description").value,
        price: document.getElementById("product-price").value,
        quantity: document.getElementById("product-quantity").value,
        size: document.getElementById("product-size").value,
        color: document.getElementById("product-color").value,
        category_id: document.getElementById("product-category").value,
        stock_status: document.getElementById("product-stock-status").value
      };

      const response = await fetch("http://127.0.0.1:8000/product/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token,
        },
        body: JSON.stringify(formData)
      });

      if (response.ok) {
        alert("‚úÖ Product added successfully!");
        modal.style.display = "none";
        form.reset();
      } else {
        alert("‚ùå Failed to add product. (Check permissions or input)");
      }
    });
  }


  async function loadCategories() {
    try {
        const response = await fetch('http://127.0.0.1:8000/category');
        const data = await response.json();
        const categories = data.categories || [];  // ‚úÖ fix here

        const select = document.getElementById('product-category');
        select.innerHTML = '';

        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            select.appendChild(option);
        });
    } catch (error) {
        console.error('Error loading categories:', error);
    }
}

  </script>

  <script src="admin_products.js"></script>

</body>
</html>
